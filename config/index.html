<!DOCTYPE html>
<html>
<head>
    <title>Weather My Way</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
</head>
<body>
<div data-role="page" id="main">
    <div data-role="header" class="jqm-header">
        <h1>Configuration</h1>
    </div>

    <div data-role="content">

        <div data-role="fieldcontain">
            <fieldset data-role="controlgroup">
                <legend>Weather Provider:</legend>
                <input type="radio" name="weather-service" id="radioyahoo" value="yahoo" class="custom" />
                <label for="radioyahoo">Yahoo! Weather</label>

                <input type="radio" name="weather-service" id="radioopen" value="open" class="custom" />
                <label for="radioopen">Open Weather Map</label>

            </fieldset>
        </div>

        <div data-role="fieldcontain">
            <label for="flipdebug">Debug Mode:</label>
            <select name="flipdebug" id="flipdebug" data-role="slider">
                <option value="off">Off</option>
                <option value="on">On</option>
            </select>
        </div>
        
    </div>

    <div class="ui-body ui-body-b">
        <fieldset class="ui-grid-a">
            <div class="ui-block-a"><button type="submit" data-theme="d" id="b-cancel">Cancel</button></div>
            <div class="ui-block-b"><button type="submit" data-theme="a" id="b-submit">Submit</button></div>
        </fieldset>
    </div>
</div>
<script>
    function saveOptions() {
        var options = {
            'debug':   $("select")[0].selectedIndex === 0 ? 'false' : 'true',
            'service': $("#radioyahoo").is(':checked') ? 'yahoo' : 'open'
        }
        return options;
    }

    function getURLParameter(name) {
        return decodeURI(
                (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
        );
    }

    $().ready(function() {
        var service = getURLParameter('s');
        if (service === 'open') {
            $("#radioopen").attr("checked", "checked");
        } else {
            $("#radioyahoo").attr("checked", "checked");
        }
        $("input[name='weather-service']").checkboxradio("refresh");

        var debug = getURLParameter('d');
        var debugSwitch = $("select");
        if (debug === 'true') {
            debugSwitch[0].selectedIndex = 1;
        } else {
            debugSwitch[0].selectedIndex = 0;
        }
        debugSwitch.slider("refresh");

        $("#b-cancel").click(function() {
            console.log("Cancel");
            document.location = "pebblejs://close";
        });

        $("#b-submit").click(function() {
            console.log("Submit");

            var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(saveOptions()));
            console.log("Warping to: " + location);
            console.log(location);
            document.location = location;
        });

    });
</script>
</body>
</html>
